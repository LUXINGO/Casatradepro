<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ðŸš€ Solana Power Trader</title>
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Korapay Checkout -->
    <script src="https://checkout.korapay.com/korapay-checkout.js"></script>
    
    <!-- Firebase -->
    <script src="https://www.gstatic.com/firebasejs/12.7.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/12.7.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/12.7.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/12.7.0/firebase-storage-compat.js"></script>
    
    <!-- TradingView Widget -->
    <script type="text/javascript" src="https://s3.tradingview.com/tv.js"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
            -webkit-font-smoothing: antialiased;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
        }
        
        :root {
            --primary: #9945FF;
            --primary-dark: #7A2CCB;
            --secondary: #14F195;
            --accent: #00D4FF;
            --dark-bg: #0F0F1E;
            --card-bg: #1A1A2E;
            --card-hover: #22223D;
            --text-primary: #FFFFFF;
            --text-secondary: #B0B0D0;
            --text-muted: #8888AA;
            --profit: #00FF9D;
            --loss: #FF4D6D;
            --buy: #00C9FF;
            --sell: #FF4757;
            --border: #2A2A4A;
            --success: #00D4AA;
            --warning: #FFB347;
            --gradient-primary: linear-gradient(135deg, #9945FF 0%, #14F195 100%);
            --gradient-dark: linear-gradient(135deg, #0F0F1E 0%, #1A1A2E 100%);
            --shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
            --shadow-lg: 0 10px 40px rgba(0, 0, 0, 0.4);
            --radius: 12px;
            --radius-sm: 8px;
            --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        body {
            background: var(--dark-bg);
            color: var(--text-primary);
            min-height: 100vh;
            overflow-x: hidden;
            padding: env(safe-area-inset-top) env(safe-area-inset-right) env(safe-area-inset-bottom) env(safe-area-inset-left);
            background-image: radial-gradient(circle at 20% 30%, rgba(153, 69, 255, 0.15) 0%, transparent 50%),
                            radial-gradient(circle at 80% 70%, rgba(20, 241, 149, 0.15) 0%, transparent 50%);
        }
        
        /* Mobile-First Container */
        .mobile-container {
            width: 100%;
            max-width: 480px;
            margin: 0 auto;
            position: relative;
            background: rgba(10, 10, 20, 0.95);
            min-height: 100vh;
            box-shadow: 0 0 30px rgba(0, 0, 0, 0.5);
            overflow-x: hidden;
        }
        
        /* Status Bar */
        .status-bar {
            height: 44px;
            background: rgba(26, 26, 46, 0.9);
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 20px;
            font-size: 14px;
            color: var(--text-secondary);
            backdrop-filter: blur(10px);
            position: fixed;
            top: 0;
            width: 100%;
            max-width: 480px;
            z-index: 1000;
        }
        
        .time {
            font-weight: 600;
        }
        
        .status-icons {
            display: flex;
            gap: 5px;
            align-items: center;
        }
        
        /* App Header */
        .app-header {
            padding: 60px 20px 20px;
            background: linear-gradient(180deg, rgba(26, 26, 46, 0.9) 0%, rgba(26, 26, 46, 0) 100%);
            backdrop-filter: blur(10px);
            position: sticky;
            top: 44px;
            z-index: 900;
        }
        
        .header-top {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .app-logo {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .logo-icon {
            width: 40px;
            height: 40px;
            background: var(--gradient-primary);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
        }
        
        .logo-text {
            font-size: 22px;
            font-weight: 800;
            background: var(--gradient-primary);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .user-menu {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .balance-badge {
            background: rgba(153, 69, 255, 0.2);
            border: 1px solid rgba(153, 69, 255, 0.4);
            border-radius: 20px;
            padding: 8px 15px;
            font-weight: 700;
            font-size: 14px;
            color: var(--secondary);
        }
        
        .profile-btn {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            overflow: hidden;
            border: 2px solid var(--primary);
            cursor: pointer;
        }
        
        .profile-btn img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        /* Round Timer */
        .round-timer {
            background: rgba(255, 255, 255, 0.05);
            border-radius: var(--radius);
            padding: 15px;
            text-align: center;
            margin-bottom: 15px;
            border: 1px solid var(--border);
        }
        
        .phase-label {
            font-size: 12px;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 5px;
        }
        
        .timer-display {
            font-size: 36px;
            font-weight: 800;
            font-family: 'Courier New', monospace;
            background: var(--gradient-primary);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin: 5px 0;
        }
        
        .round-info {
            font-size: 13px;
            color: var(--text-secondary);
        }
        
        /* Main Content */
        .main-content {
            padding: 20px;
            padding-bottom: 80px;
        }
        
        /* Chart Container */
        .chart-container {
            background: var(--card-bg);
            border-radius: var(--radius);
            padding: 15px;
            margin-bottom: 20px;
            border: 1px solid var(--border);
            height: 300px;
            position: relative;
            overflow: hidden;
        }
        
        #tradingview-chart {
            width: 100%;
            height: 100%;
            border-radius: var(--radius-sm);
        }
        
        /* Trading Controls */
        .trading-controls {
            background: var(--card-bg);
            border-radius: var(--radius);
            padding: 20px;
            margin-bottom: 20px;
            border: 1px solid var(--border);
        }
        
        .trade-buttons {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-bottom: 20px;
        }
        
        .trade-btn {
            padding: 20px;
            border: none;
            border-radius: var(--radius-sm);
            font-size: 18px;
            font-weight: 800;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            cursor: pointer;
            transition: var(--transition);
        }
        
        .buy-btn {
            background: linear-gradient(135deg, rgba(0, 201, 255, 0.2) 0%, rgba(0, 201, 255, 0.1) 100%);
            border: 2px solid var(--buy);
            color: var(--buy);
        }
        
        .buy-btn:active {
            background: linear-gradient(135deg, var(--buy) 0%, rgba(0, 201, 255, 0.7) 100%);
            color: white;
            transform: scale(0.98);
        }
        
        .sell-btn {
            background: linear-gradient(135deg, rgba(255, 71, 87, 0.2) 0%, rgba(255, 71, 87, 0.1) 100%);
            border: 2px solid var(--sell);
            color: var(--sell);
        }
        
        .sell-btn:active {
            background: linear-gradient(135deg, var(--sell) 0%, rgba(255, 71, 87, 0.7) 100%);
            color: white;
            transform: scale(0.98);
        }
        
        .lot-controls {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
            margin-bottom: 20px;
        }
        
        .lot-btn {
            padding: 15px 5px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid var(--border);
            border-radius: var(--radius-sm);
            color: var(--text-primary);
            text-align: center;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
        }
        
        .lot-btn.active {
            background: var(--gradient-primary);
            color: white;
            border-color: transparent;
        }
        
        .lot-btn:active {
            transform: scale(0.95);
        }
        
        .tp-sl-controls {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-bottom: 20px;
        }
        
        .tp-sl-input {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid var(--border);
            border-radius: var(--radius-sm);
            padding: 15px;
            color: var(--text-primary);
            font-size: 16px;
            text-align: center;
        }
        
        .tp-sl-input:focus {
            outline: none;
            border-color: var(--primary);
        }
        
        .quick-actions {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
        }
        
        .action-btn {
            padding: 15px 10px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid var(--border);
            border-radius: var(--radius-sm);
            color: var(--text-primary);
            font-size: 14px;
            font-weight: 600;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 5px;
            cursor: pointer;
            transition: var(--transition);
        }
        
        .action-btn:active {
            background: rgba(153, 69, 255, 0.2);
            transform: scale(0.95);
        }
        
        .action-btn i {
            font-size: 18px;
            color: var(--primary);
        }
        
        /* Open Trades */
        .open-trades {
            background: var(--card-bg);
            border-radius: var(--radius);
            padding: 20px;
            margin-bottom: 20px;
            border: 1px solid var(--border);
        }
        
        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .section-title {
            font-size: 18px;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .trades-list {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        
        .trade-item {
            background: rgba(255, 255, 255, 0.03);
            border-radius: var(--radius-sm);
            padding: 15px;
            border-left: 4px solid var(--buy);
        }
        
        .trade-item.sell {
            border-left-color: var(--sell);
        }
        
        .trade-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .trade-type {
            display: flex;
            align-items: center;
            gap: 8px;
            font-weight: 700;
        }
        
        .trade-type.buy {
            color: var(--buy);
        }
        
        .trade-type.sell {
            color: var(--sell);
        }
        
        .trade-pnl {
            font-size: 18px;
            font-weight: 800;
        }
        
        .pnl-positive {
            color: var(--profit);
        }
        
        .pnl-negative {
            color: var(--loss);
        }
        
        .trade-details {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-bottom: 15px;
        }
        
        .detail-item label {
            display: block;
            font-size: 11px;
            color: var(--text-secondary);
            margin-bottom: 3px;
        }
        
        .detail-item span {
            font-weight: 600;
            font-size: 14px;
        }
        
        .trade-actions {
            display: flex;
            gap: 10px;
        }
        
        .close-btn {
            flex: 1;
            padding: 10px;
            background: linear-gradient(135deg, var(--loss), #FF2E4A);
            border: none;
            border-radius: var(--radius-sm);
            color: white;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
        }
        
        .close-btn:active {
            transform: scale(0.95);
        }
        
        /* Players Section */
        .players-section {
            background: var(--card-bg);
            border-radius: var(--radius);
            padding: 20px;
            margin-bottom: 20px;
            border: 1px solid var(--border);
        }
        
        .players-count {
            background: var(--primary);
            color: white;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
        }
        
        .players-list {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-top: 15px;
        }
        
        .player-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px;
            background: rgba(255, 255, 255, 0.03);
            border-radius: var(--radius-sm);
        }
        
        .player-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            object-fit: cover;
            border: 2px solid var(--primary);
        }
        
        .player-info {
            flex: 1;
        }
        
        .player-name {
            font-weight: 600;
            margin-bottom: 3px;
        }
        
        .player-stats {
            display: flex;
            gap: 10px;
            font-size: 12px;
            color: var(--text-secondary);
        }
        
        .player-pnl {
            font-weight: 700;
            font-size: 16px;
        }
        
        .pnl-positive {
            color: var(--profit);
        }
        
        .pnl-negative {
            color: var(--loss);
        }
        
        /* Bottom Navigation */
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            max-width: 480px;
            margin: 0 auto;
            background: rgba(26, 26, 46, 0.95);
            backdrop-filter: blur(20px);
            border-top: 1px solid var(--border);
            display: flex;
            justify-content: space-around;
            padding: 10px 0;
            z-index: 1000;
        }
        
        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 5px;
            color: var(--text-secondary);
            text-decoration: none;
            padding: 10px 15px;
            border-radius: var(--radius-sm);
            transition: var(--transition);
        }
        
        .nav-item.active {
            color: var(--primary);
            background: rgba(153, 69, 255, 0.1);
        }
        
        .nav-item i {
            font-size: 22px;
        }
        
        .nav-item span {
            font-size: 11px;
            font-weight: 600;
        }
        
        /* Auth Screens */
        .auth-container {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: var(--gradient-dark);
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
            z-index: 2000;
            overflow-y: auto;
        }
        
        .auth-box {
            background: var(--card-bg);
            border-radius: var(--radius);
            padding: 30px;
            width: 100%;
            max-width: 400px;
            border: 1px solid var(--border);
            box-shadow: var(--shadow-lg);
        }
        
        .auth-header {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .auth-logo {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .auth-title {
            font-size: 28px;
            font-weight: 800;
            background: var(--gradient-primary);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 10px;
        }
        
        .auth-subtitle {
            color: var(--text-secondary);
            font-size: 14px;
        }
        
        .auth-form {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        
        .form-group {
            position: relative;
        }
        
        .form-label {
            display: block;
            margin-bottom: 8px;
            color: var(--text-secondary);
            font-size: 14px;
            font-weight: 500;
        }
        
        .form-input {
            width: 100%;
            padding: 16px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid var(--border);
            border-radius: var(--radius-sm);
            color: var(--text-primary);
            font-size: 16px;
            transition: var(--transition);
        }
        
        .form-input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(153, 69, 255, 0.1);
        }
        
        .form-input.has-icon {
            padding-left: 50px;
        }
        
        .form-icon {
            position: absolute;
            left: 16px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--text-muted);
            font-size: 18px;
        }
        
        .password-toggle {
            position: absolute;
            right: 16px;
            top: 50%;
            transform: translateY(-50%);
            background: none;
            border: none;
            color: var(--text-muted);
            cursor: pointer;
            font-size: 18px;
        }
        
        .btn {
            padding: 18px;
            border: none;
            border-radius: var(--radius-sm);
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        
        .btn-primary {
            background: var(--gradient-primary);
            color: white;
        }
        
        .btn-primary:active {
            transform: scale(0.98);
        }
        
        .btn-secondary {
            background: rgba(255, 255, 255, 0.1);
            color: var(--text-primary);
            border: 1px solid var(--border);
        }
        
        .btn-secondary:active {
            transform: scale(0.98);
        }
        
        .auth-footer {
            text-align: center;
            margin-top: 25px;
            padding-top: 20px;
            border-top: 1px solid var(--border);
        }
        
        .auth-link {
            color: var(--primary);
            text-decoration: none;
            font-weight: 600;
        }
        
        /* Profile Page */
        .profile-page, .leaderboard-page, .premium-page, .referral-page {
            padding: 20px;
            padding-bottom: 100px;
            display: none;
        }
        
        .profile-header {
            display: flex;
            align-items: center;
            gap: 20px;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid var(--border);
        }
        
        .profile-avatar-container {
            position: relative;
        }
        
        .profile-avatar {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            object-fit: cover;
            border: 3px solid var(--primary);
        }
        
        .avatar-upload-btn {
            position: absolute;
            bottom: 0;
            right: 0;
            width: 32px;
            height: 32px;
            background: var(--gradient-primary);
            border: none;
            border-radius: 50%;
            color: white;
            font-size: 14px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .profile-info h2 {
            font-size: 24px;
            font-weight: 700;
            margin-bottom: 5px;
        }
        
        .profile-info p {
            color: var(--text-secondary);
            font-size: 14px;
        }
        
        .profile-stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin-bottom: 30px;
        }
        
        .stat-card {
            background: rgba(255, 255, 255, 0.05);
            border-radius: var(--radius-sm);
            padding: 15px;
            text-align: center;
        }
        
        .stat-value {
            font-size: 24px;
            font-weight: 800;
            color: var(--secondary);
            display: block;
            margin-bottom: 5px;
        }
        
        .stat-label {
            font-size: 12px;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .profile-actions {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-bottom: 30px;
        }
        
        /* Maintenance Screen */
        .maintenance-screen {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(15, 15, 30, 0.95);
            backdrop-filter: blur(20px);
            display: none;
            align-items: center;
            justify-content: center;
            padding: 20px;
            z-index: 3000;
        }
        
        .maintenance-content {
            background: var(--card-bg);
            border-radius: var(--radius);
            padding: 30px;
            max-width: 400px;
            text-align: center;
            border: 1px solid var(--border);
            box-shadow: var(--shadow-lg);
        }
        
        .maintenance-icon {
            width: 80px;
            height: 80px;
            background: var(--gradient-primary);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 36px;
            margin: 0 auto 20px;
        }
        
        .maintenance-title {
            font-size: 28px;
            font-weight: 800;
            margin-bottom: 15px;
            background: var(--gradient-primary);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .maintenance-timer {
            font-size: 48px;
            font-weight: 800;
            font-family: 'Courier New', monospace;
            color: var(--secondary);
            margin: 20px 0;
        }
        
        .winners-list {
            margin-top: 30px;
        }
        
        /* Toast Notifications */
        .toast-container {
            position: fixed;
            top: 80px;
            left: 20px;
            right: 20px;
            z-index: 4000;
        }
        
        .toast {
            background: var(--card-bg);
            border-left: 4px solid var(--primary);
            border-radius: var(--radius-sm);
            padding: 15px;
            margin-bottom: 10px;
            box-shadow: var(--shadow);
            display: flex;
            align-items: center;
            gap: 12px;
            animation: slideIn 0.3s ease-out;
            transform-origin: top;
        }
        
        .toast i {
            font-size: 20px;
        }
        
        .toast.success {
            border-left-color: var(--success);
        }
        
        .toast.error {
            border-left-color: var(--loss);
        }
        
        .toast.warning {
            border-left-color: var(--warning);
        }
        
        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        /* Payment Modal */
        .payment-modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.9);
            backdrop-filter: blur(20px);
            display: none;
            align-items: center;
            justify-content: center;
            padding: 20px;
            z-index: 4000;
        }
        
        .payment-content {
            background: var(--card-bg);
            border-radius: var(--radius);
            padding: 25px;
            width: 100%;
            max-width: 400px;
            border: 1px solid var(--border);
            box-shadow: var(--shadow-lg);
        }
        
        .payment-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 25px;
        }
        
        .payment-title {
            font-size: 22px;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .close-payment {
            background: none;
            border: none;
            color: var(--text-secondary);
            font-size: 24px;
            cursor: pointer;
        }
        
        .amount-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin-bottom: 25px;
        }
        
        .amount-option {
            padding: 15px 5px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid var(--border);
            border-radius: var(--radius-sm);
            text-align: center;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
        }
        
        .amount-option.active {
            background: var(--gradient-primary);
            color: white;
            border-color: transparent;
        }
        
        .amount-input {
            width: 100%;
            padding: 18px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid var(--border);
            border-radius: var(--radius-sm);
            color: var(--text-primary);
            font-size: 18px;
            text-align: center;
            margin-bottom: 25px;
        }
        
        .payment-summary {
            background: rgba(255, 255, 255, 0.03);
            border-radius: var(--radius-sm);
            padding: 20px;
            margin-bottom: 25px;
        }
        
        .summary-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            color: var(--text-secondary);
        }
        
        .summary-item.total {
            color: var(--text-primary);
            font-weight: 700;
            font-size: 18px;
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid var(--border);
        }
        
        .payment-methods {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin-bottom: 25px;
        }
        
        .payment-method {
            padding: 15px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid var(--border);
            border-radius: var(--radius-sm);
            text-align: center;
            cursor: pointer;
            transition: var(--transition);
        }
        
        .payment-method.active {
            background: rgba(153, 69, 255, 0.2);
            border-color: var(--primary);
        }
        
        .payment-method i {
            font-size: 24px;
            margin-bottom: 8px;
            color: var(--primary);
        }
        
        /* Referral Page */
        .referral-code-box {
            background: linear-gradient(135deg, rgba(153, 69, 255, 0.2), rgba(20, 241, 149, 0.2));
            border: 1px solid rgba(153, 69, 255, 0.3);
            border-radius: var(--radius);
            padding: 25px;
            text-align: center;
            margin-bottom: 30px;
        }
        
        .referral-code {
            font-size: 32px;
            font-weight: 800;
            font-family: 'Courier New', monospace;
            color: var(--secondary);
            margin: 15px 0;
            background: rgba(0, 0, 0, 0.3);
            padding: 10px;
            border-radius: var(--radius-sm);
            letter-spacing: 2px;
        }
        
        .referral-stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin-bottom: 30px;
        }
        
        /* Loading Overlay */
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(15, 15, 30, 0.95);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 5000;
        }
        
        .loader {
            width: 60px;
            height: 60px;
            border: 4px solid var(--border);
            border-top: 4px solid var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* Responsive Adjustments */
        @media (max-width: 480px) {
            .mobile-container {
                max-width: 100%;
            }
            
            .status-bar {
                max-width: 100%;
            }
            
            .bottom-nav {
                max-width: 100%;
            }
        }
        
        /* iPhone Notch Support */
        @supports (padding: max(0px)) {
            .mobile-container {
                padding-left: max(20px, env(safe-area-inset-left));
                padding-right: max(20px, env(safe-area-inset-right));
            }
        }
        
        /* Hide scrollbar for Chrome, Safari and Opera */
        .hide-scrollbar::-webkit-scrollbar {
            display: none;
        }
        
        /* Hide scrollbar for IE, Edge and Firefox */
        .hide-scrollbar {
            -ms-overflow-style: none;  /* IE and Edge */
            scrollbar-width: none;  /* Firefox */
        }
    </style>
</head>
<body>
    <!-- Mobile Container -->
    <div class="mobile-container">
        <!-- Status Bar -->
        <div class="status-bar">
            <div class="time" id="currentTime">09:41</div>
            <div class="status-icons">
                <i class="fas fa-signal"></i>
                <i class="fas fa-wifi"></i>
                <i class="fas fa-battery-full"></i>
            </div>
        </div>
        
        <!-- App Header -->
        <div class="app-header">
            <div class="header-top">
                <div class="app-logo">
                    <div class="logo-icon">
                        <i class="fas fa-rocket"></i>
                    </div>
                    <div class="logo-text">SOL TRADER</div>
                </div>
                <div class="user-menu">
                    <div class="balance-badge" id="headerBalance">$0.00</div>
                    <div class="profile-btn" onclick="showPage('profile')">
                        <img src="https://ui-avatars.com/api/?name=U&background=9945FF&color=fff" alt="Profile" id="headerProfilePic">
                    </div>
                </div>
            </div>
            
            <div class="round-timer">
                <div class="phase-label" id="phaseLabel">TRADING OPEN</div>
                <div class="timer-display" id="roundTimer">20</div>
                <div class="round-info">Next round starts in</div>
            </div>
        </div>
        
        <!-- Main Content Area -->
        <div class="main-content" id="mainContent">
            <!-- Trading Dashboard -->
            <div id="dashboardPage">
                <!-- Chart Container -->
                <div class="chart-container">
                    <div id="tradingview-chart"></div>
                </div>
                
                <!-- Trading Controls -->
                <div class="trading-controls">
                    <div class="trade-buttons">
                        <button class="trade-btn buy-btn" onclick="placeTrade('buy')">
                            <i class="fas fa-arrow-up"></i> BUY
                        </button>
                        <button class="trade-btn sell-btn" onclick="placeTrade('sell')">
                            <i class="fas fa-arrow-down"></i> SELL
                        </button>
                    </div>
                    
                    <div class="lot-controls">
                        <button class="lot-btn active" onclick="setLotSize(0.01)">0.01</button>
                        <button class="lot-btn" onclick="setLotSize(0.05)">0.05</button>
                        <button class="lot-btn" onclick="setLotSize(0.1)">0.1</button>
                        <button class="lot-btn" onclick="setLotSize(0.5)">0.5</button>
                    </div>
                    
                    <div class="tp-sl-controls">
                        <input type="number" class="tp-sl-input" id="takeProfit" value="40" placeholder="TP pips">
                        <input type="number" class="tp-sl-input" id="stopLoss" value="20" placeholder="SL pips">
                    </div>
                    
                    <div class="quick-actions">
                        <button class="action-btn" onclick="showDepositModal()">
                            <i class="fas fa-arrow-down"></i>
                            Deposit
                        </button>
                        <button class="action-btn" onclick="showWithdrawModal()">
                            <i class="fas fa-arrow-up"></i>
                            Withdraw
                        </button>
                        <button class="action-btn" onclick="showPage('premium')">
                            <i class="fas fa-crown"></i>
                            Upgrade
                        </button>
                    </div>
                </div>
                
                <!-- Open Trades -->
                <div class="open-trades">
                    <div class="section-header">
                        <div class="section-title">
                            <i class="fas fa-briefcase"></i>
                            Open Trades
                        </div>
                        <div class="players-count" id="openTradesCount">0</div>
                    </div>
                    <div class="trades-list" id="openTradesList"></div>
                </div>
                
                <!-- Live Traders -->
                <div class="players-section">
                    <div class="section-header">
                        <div class="section-title">
                            <i class="fas fa-users"></i>
                            Live Traders
                        </div>
                        <div class="players-count" id="playersCount">0</div>
                    </div>
                    <div class="players-list" id="playersList"></div>
                </div>
            </div>
            
            <!-- Profile Page -->
            <div class="profile-page" id="profilePage">
                <div class="profile-header">
                    <div class="profile-avatar-container">
                        <img src="https://ui-avatars.com/api/?name=U&background=9945FF&color=fff" 
                             alt="Profile" class="profile-avatar" id="profileAvatar">
                        <button class="avatar-upload-btn" onclick="document.getElementById('avatarUpload').click()">
                            <i class="fas fa-camera"></i>
                        </button>
                        <input type="file" id="avatarUpload" accept="image/*" hidden onchange="uploadProfilePicture()">
                    </div>
                    <div class="profile-info">
                        <h2 id="profileName">User</h2>
                        <p id="profileEmail">user@email.com</p>
                        <p id="profileUsername">@username</p>
                    </div>
                </div>
                
                <div class="profile-stats">
                    <div class="stat-card">
                        <span class="stat-value" id="totalTrades">0</span>
                        <span class="stat-label">Total Trades</span>
                    </div>
                    <div class="stat-card">
                        <span class="stat-value" id="winRate">0%</span>
                        <span class="stat-label">Win Rate</span>
                    </div>
                    <div class="stat-card">
                        <span class="stat-value" id="totalProfit">$0</span>
                        <span class="stat-label">Profit</span>
                    </div>
                </div>
                
                <div class="profile-actions">
                    <button class="btn btn-primary" onclick="showDepositModal()">
                        <i class="fas fa-arrow-down"></i> Deposit Funds
                    </button>
                    <button class="btn btn-secondary" onclick="showWithdrawModal()">
                        <i class="fas fa-arrow-up"></i> Withdraw Funds
                    </button>
                    <button class="btn btn-secondary" onclick="showTransactionHistory()">
                        <i class="fas fa-history"></i> Transaction History
                    </button>
                    <button class="btn btn-secondary" onclick="showPage('referral')">
                        <i class="fas fa-users"></i> Referral Program
                    </button>
                    <button class="btn btn-secondary" onclick="logout()" style="background: rgba(255, 77, 109, 0.2); color: var(--loss);">
                        <i class="fas fa-sign-out-alt"></i> Logout
                    </button>
                </div>
                
                <div class="profile-actions">
                    <h3 style="margin-bottom: 15px;"><i class="fas fa-cog"></i> Account Settings</h3>
                    <input type="text" class="form-input" id="editName" placeholder="Full Name" style="margin-bottom: 10px;">
                    <input type="text" class="form-input" id="editUsername" placeholder="Username" style="margin-bottom: 10px;">
                    <input type="password" class="form-input" id="editPin" placeholder="Transaction PIN (4 digits)" maxlength="4" style="margin-bottom: 15px;">
                    <button class="btn btn-primary" onclick="updateProfile()">
                        <i class="fas fa-save"></i> Save Changes
                    </button>
                </div>
            </div>
            
            <!-- Leaderboard Page -->
            <div class="leaderboard-page" id="leaderboardPage">
                <div class="section-header" style="margin-bottom: 30px;">
                    <div class="section-title">
                        <i class="fas fa-trophy"></i>
                        Leaderboard
                    </div>
                </div>
                
                <div style="display: flex; gap: 10px; margin-bottom: 20px;">
                    <button class="btn btn-primary" onclick="loadLeaderboard('daily')">Daily</button>
                    <button class="btn btn-secondary" onclick="loadLeaderboard('weekly')">Weekly</button>
                    <button class="btn btn-secondary" onclick="loadLeaderboard('monthly')">Monthly</button>
                </div>
                
                <div id="leaderboardList"></div>
            </div>
            
            <!-- Premium Page -->
            <div class="premium-page" id="premiumPage">
                <div class="section-header" style="margin-bottom: 30px;">
                    <div class="section-title">
                        <i class="fas fa-crown"></i>
                        Upgrade Account
                    </div>
                </div>
                
                <div class="referral-code-box" style="margin-bottom: 30px;">
                    <h3 style="margin-bottom: 15px;">Unlock Advanced Features</h3>
                    <p style="color: var(--text-secondary); margin-bottom: 20px;">
                        Upgrade your account to access premium trading pairs and features
                    </p>
                </div>
                
                <div class="payment-summary" style="margin-bottom: 30px;">
                    <h4 style="margin-bottom: 15px;">Available Plans</h4>
                    
                    <div style="margin-bottom: 20px; padding: 15px; background: rgba(255, 255, 255, 0.03); border-radius: var(--radius-sm);">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                            <span>Pro Plan</span>
                            <span style="color: var(--secondary); font-weight: 700;">$10</span>
                        </div>
                        <p style="font-size: 13px; color: var(--text-secondary); margin-bottom: 15px;">
                            â€¢ Trade SOL/USD & BTC/USD<br>
                            â€¢ Higher lot sizes<br>
                            â€¢ Priority support
                        </p>
                        <button class="btn btn-primary" style="width: 100%;" onclick="upgradeToPlan('pro')">
                            <i class="fas fa-bolt"></i> Upgrade to Pro
                        </button>
                    </div>
                    
                    <div style="padding: 15px; background: rgba(153, 69, 255, 0.1); border: 1px solid var(--primary); border-radius: var(--radius-sm);">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                            <span>Premium Plan</span>
                            <span style="color: var(--secondary); font-weight: 700;">$25</span>
                        </div>
                        <p style="font-size: 13px; color: var(--text-secondary); margin-bottom: 15px;">
                            â€¢ Trade SOL/USD, BTC/USD & XAU/USD<br>
                            â€¢ All Pro features<br>
                            â€¢ Advanced chart tools<br>
                            â€¢ Zero commission
                        </p>
                        <button class="btn btn-primary" style="width: 100%; background: linear-gradient(135deg, #FFD700, #FFA500);" onclick="upgradeToPlan('premium')">
                            <i class="fas fa-crown"></i> Upgrade to Premium
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- Referral Page -->
            <div class="referral-page" id="referralPage">
                <div class="section-header" style="margin-bottom: 30px;">
                    <div class="section-title">
                        <i class="fas fa-users"></i>
                        Referral Program
                    </div>
                </div>
                
                <div class="referral-code-box">
                    <h3 style="margin-bottom: 10px;">Your Referral Code</h3>
                    <p style="color: var(--text-secondary); margin-bottom: 15px;">
                        Share this code with friends to earn rewards
                    </p>
                    <div class="referral-code" id="referralCode">ABCD123</div>
                    <button class="btn btn-primary" onclick="copyReferralCode()">
                        <i class="fas fa-copy"></i> Copy Code
                    </button>
                </div>
                
                <div class="referral-stats">
                    <div class="stat-card">
                        <span class="stat-value" id="totalReferrals">0</span>
                        <span class="stat-label">Total Referrals</span>
                    </div>
                    <div class="stat-card">
                        <span class="stat-value" id="activeReferrals">0</span>
                        <span class="stat-label">Active Referrals</span>
                    </div>
                    <div class="stat-card">
                        <span class="stat-value" id="referralEarnings">$0</span>
                        <span class="stat-label">Earnings</span>
                    </div>
                </div>
                
                <div style="background: rgba(255, 255, 255, 0.03); border-radius: var(--radius); padding: 20px; margin-bottom: 30px;">
                    <h4 style="margin-bottom: 15px;"><i class="fas fa-gift"></i> How It Works</h4>
                    <p style="color: var(--text-secondary); font-size: 14px; line-height: 1.5; margin-bottom: 15px;">
                        1. Share your referral code with friends<br>
                        2. They sign up using your code and make a deposit<br>
                        3. Each friend must trade at least once<br>
                        4. Earn $2 for every 10 active referrals<br>
                        5. Your $1 bonus can be multiplied x3 through trading
                    </p>
                </div>
                
                <div id="referralList"></div>
            </div>
        </div>
        
        <!-- Bottom Navigation -->
        <div class="bottom-nav">
            <a href="#" class="nav-item active" onclick="showPage('dashboard')">
                <i class="fas fa-chart-line"></i>
                <span>Trade</span>
            </a>
            <a href="#" class="nav-item" onclick="showPage('leaderboard')">
                <i class="fas fa-trophy"></i>
                <span>Leaders</span>
            </a>
            <a href="#" class="nav-item" onclick="showDepositModal()">
                <i class="fas fa-plus-circle"></i>
                <span>Deposit</span>
            </a>
            <a href="#" class="nav-item" onclick="showPage('profile')">
                <i class="fas fa-user"></i>
                <span>Profile</span>
            </a>
            <a href="#" class="nav-item" onclick="showPage('referral')">
                <i class="fas fa-share-alt"></i>
                <span>Refer</span>
            </a>
        </div>
    </div>
    
    <!-- Auth Container -->
    <div class="auth-container" id="authContainer">
        <!-- Login Form -->
        <div class="auth-box" id="loginBox">
            <div class="auth-header">
                <div class="auth-logo">
                    <div class="logo-icon">
                        <i class="fas fa-rocket"></i>
                    </div>
                </div>
                <h1 class="auth-title">SOLANA TRADER</h1>
                <p class="auth-subtitle">Start trading with $1 bonus</p>
            </div>
            
            <div class="auth-form">
                <div class="form-group">
                    <label class="form-label">Email Address</label>
                    <div class="form-icon"><i class="fas fa-envelope"></i></div>
                    <input type="email" id="loginEmail" class="form-input has-icon" placeholder="Enter your email">
                </div>
                
                <div class="form-group">
                    <label class="form-label">Password</label>
                    <div class="form-icon"><i class="fas fa-lock"></i></div>
                    <input type="password" id="loginPassword" class="form-input has-icon" placeholder="Enter your password">
                    <button class="password-toggle" onclick="togglePassword('loginPassword')">
                        <i class="fas fa-eye"></i>
                    </button>
                </div>
                
                <button class="btn btn-primary" onclick="login()">
                    <i class="fas fa-sign-in-alt"></i> Sign In
                </button>
            </div>
            
            <div class="auth-footer">
                <p>Don't have an account? <a href="#" class="auth-link" onclick="showSignup()">Create Account</a></p>
            </div>
        </div>
        
        <!-- Signup Form -->
        <div class="auth-box" id="signupBox" style="display: none;">
            <div class="auth-header">
                <div class="auth-logo">
                    <div class="logo-icon">
                        <i class="fas fa-user-plus"></i>
                    </div>
                </div>
                <h1 class="auth-title">Create Account</h1>
                <p class="auth-subtitle">Join thousands of traders</p>
            </div>
            
            <div class="auth-form">
                <div class="form-group">
                    <label class="form-label">Full Name</label>
                    <div class="form-icon"><i class="fas fa-user"></i></div>
                    <input type="text" id="signupName" class="form-input has-icon" placeholder="Enter full name">
                </div>
                
                <div class="form-group">
                    <label class="form-label">Username</label>
                    <div class="form-icon"><i class="fas fa-at"></i></div>
                    <input type="text" id="signupUsername" class="form-input has-icon" placeholder="Choose username">
                </div>
                
                <div class="form-group">
                    <label class="form-label">Email Address</label>
                    <div class="form-icon"><i class="fas fa-envelope"></i></div>
                    <input type="email" id="signupEmail" class="form-input has-icon" placeholder="Enter email">
                </div>
                
                <div class="form-group">
                    <label class="form-label">Date of Birth</label>
                    <div class="form-icon"><i class="fas fa-calendar"></i></div>
                    <input type="date" id="signupDob" class="form-input has-icon">
                </div>
                
                <div class="form-group">
                    <label class="form-label">Password</label>
                    <div class="form-icon"><i class="fas fa-lock"></i></div>
                    <input type="password" id="signupPassword" class="form-input has-icon" placeholder="Create password">
                    <button class="password-toggle" onclick="togglePassword('signupPassword')">
                        <i class="fas fa-eye"></i>
                    </button>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Confirm Password</label>
                    <div class="form-icon"><i class="fas fa-lock"></i></div>
                    <input type="password" id="signupConfirmPassword" class="form-input has-icon" placeholder="Confirm password">
                </div>
                
                <div class="form-group">
                    <label class="form-label">4-Digit Transaction PIN</label>
                    <div class="form-icon"><i class="fas fa-key"></i></div>
                    <input type="password" id="signupPin" class="form-input has-icon" placeholder="XXXX" maxlength="4" pattern="\d{4}">
                </div>
                
                <div class="form-group">
                    <label class="form-label">Referral Code (Optional)</label>
                    <div class="form-icon"><i class="fas fa-user-friends"></i></div>
                    <input type="text" id="signupReferralCode" class="form-input has-icon" placeholder="Enter referral code">
                </div>
                
                <button class="btn btn-primary" onclick="signup()">
                    <i class="fas fa-user-plus"></i> Create Account
                </button>
            </div>
            
            <div class="auth-footer">
                <p>Already have an account? <a href="#" class="auth-link" onclick="showLogin()">Sign In</a></p>
            </div>
        </div>
    </div>
    
    <!-- Deposit Modal -->
    <div class="payment-modal" id="depositModal">
        <div class="payment-content">
            <div class="payment-header">
                <h2 class="payment-title"><i class="fas fa-arrow-down"></i> Deposit</h2>
                <button class="close-payment" onclick="closePaymentModal()">Ã—</button>
            </div>
            
            <div class="amount-grid">
                <div class="amount-option" onclick="selectDepositAmount(10)">$10</div>
                <div class="amount-option" onclick="selectDepositAmount(25)">$25</div>
                <div class="amount-option active" onclick="selectDepositAmount(50)">$50</div>
                <div class="amount-option" onclick="selectDepositAmount(100)">$100</div>
                <div class="amount-option" onclick="selectDepositAmount(250)">$250</div>
                <div class="amount-option" onclick="selectDepositAmount(500)">$500</div>
            </div>
            
            <input type="number" id="depositAmount" class="amount-input" value="50" min="5" max="10000" oninput="updateDepositSummary()">
            
            <div class="payment-summary">
                <div class="summary-item">
                    <span>Amount:</span>
                    <span id="depositSummaryAmount">$50.00</span>
                </div>
                <div class="summary-item">
                    <span>Fee (2.5%):</span>
                    <span id="depositFee">$1.25</span>
                </div>
                <div class="summary-item total">
                    <span>Total to pay:</span>
                    <span id="depositTotal">$51.25</span>
                </div>
            </div>
            
            <div class="payment-methods">
                <div class="payment-method active" onclick="selectPaymentMethod('card')">
                    <i class="fas fa-credit-card"></i>
                    <div>Card</div>
                </div>
                <div class="payment-method" onclick="selectPaymentMethod('bank')">
                    <i class="fas fa-university"></i>
                    <div>Bank</div>
                </div>
            </div>
            
            <button class="btn btn-primary" style="width: 100%; margin-top: 20px;" onclick="processDeposit()">
                <i class="fas fa-lock"></i> Proceed to Payment
            </button>
            
            <div style="text-align: center; margin-top: 20px; color: var(--text-secondary); font-size: 12px;">
                <i class="fas fa-shield-alt"></i> Secure payment by Korapay
            </div>
        </div>
    </div>
    
    <!-- Withdraw Modal -->
    <div class="payment-modal" id="withdrawModal">
        <div class="payment-content">
            <div class="payment-header">
                <h2 class="payment-title"><i class="fas fa-arrow-up"></i> Withdraw</h2>
                <button class="close-payment" onclick="closePaymentModal()">Ã—</button>
            </div>
            
            <div class="amount-grid">
                <div class="amount-option" onclick="selectWithdrawAmount(20)">$20</div>
                <div class="amount-option" onclick="selectWithdrawAmount(50)">$50</div>
                <div class="amount-option active" onclick="selectWithdrawAmount(100)">$100</div>
                <div class="amount-option" onclick="selectWithdrawAmount(200)">$200</div>
                <div class="amount-option" onclick="selectWithdrawAmount(500)">$500</div>
                <div class="amount-option" onclick="selectWithdrawAmount(1000)">$1000</div>
            </div>
            
            <input type="number" id="withdrawAmount" class="amount-input" value="100" min="20" max="10000" oninput="updateWithdrawSummary()">
            
            <div style="margin: 25px 0;">
                <label class="form-label">Bank Account Details</label>
                <input type="text" id="bankName" class="form-input" placeholder="Bank Name" style="margin-bottom: 10px;">
                <input type="text" id="accountNumber" class="form-input" placeholder="Account Number" style="margin-bottom: 10px;">
                <input type="text" id="accountName" class="form-input" placeholder="Account Name">
            </div>
            
            <div class="payment-summary">
                <div class="summary-item">
                    <span>Amount:</span>
                    <span id="withdrawSummaryAmount">$100.00</span>
                </div>
                <div class="summary-item">
                    <span>Fee (1.5%):</span>
                    <span id="withdrawFee">$1.50</span>
                </div>
                <div class="summary-item">
                    <span>Tax (10%):</span>
                    <span id="withdrawTax">$10.00</span>
                </div>
                <div class="summary-item total">
                    <span>You receive:</span>
                    <span id="withdrawTotal">$88.50</span>
                </div>
            </div>
            
            <input type="password" id="withdrawPin" class="form-input" placeholder="Enter your 4-digit PIN" maxlength="4" style="margin: 20px 0;">
            
            <button class="btn btn-primary" style="width: 100%;" onclick="processWithdrawal()">
                <i class="fas fa-paper-plane"></i> Process Withdrawal
            </button>
            
            <div style="text-align: center; margin-top: 20px; color: var(--text-secondary); font-size: 12px;">
                <i class="fas fa-clock"></i> Processing: 24-48 hours
            </div>
        </div>
    </div>
    
    <!-- Transaction History Modal -->
    <div class="payment-modal" id="transactionModal">
        <div class="payment-content">
            <div class="payment-header">
                <h2 class="payment-title"><i class="fas fa-history"></i> Transactions</h2>
                <button class="close-payment" onclick="closePaymentModal()">Ã—</button>
            </div>
            <div id="transactionList"></div>
        </div>
    </div>
    
    <!-- Maintenance Screen -->
    <div class="maintenance-screen" id="maintenanceScreen">
        <div class="maintenance-content">
            <div class="maintenance-icon">
                <i class="fas fa-tools"></i>
            </div>
            <h1 class="maintenance-title">Maintenance Break</h1>
            <p style="color: var(--text-secondary); margin-bottom: 20px;">
                Platform is undergoing scheduled maintenance.<br>
                Trading will resume shortly.
            </p>
            <div class="maintenance-timer" id="maintenanceTimer">03:00</div>
            
            <div class="winners-list" id="winnersList"></div>
            
            <div style="margin-top: 30px; color: var(--text-secondary); font-size: 14px;">
                Next maintenance in: <span id="nextMaintenance">12:00:00</span>
            </div>
        </div>
    </div>
    
    <!-- Loading Overlay -->
    <div class="loading-overlay" id="loadingOverlay">
        <div class="loader"></div>
    </div>
    
    <!-- Toast Container -->
    <div class="toast-container" id="toastContainer"></div>

    <!-- Main App Script -->
    <script>
        // ============= CONFIGURATION =============
        const FIREBASE_CONFIG = {
            apiKey: "AIzaSyBVZkRPI9CkfG-FcLgsvoI4d3XZ5Su0kig",
            authDomain: "casa-89b8b.firebaseapp.com",
            projectId: "casa-89b8b",
            storageBucket: "casa-89b8b.firebasestorage.app",
            messagingSenderId: "514297483398",
            appId: "1:514297483398:web:664f0a6891fe707c54c107",
            measurementId: "G-GWSMFD0JKS"
        };
        
        // Backend API URL - Use your Railway backend URL
        const BACKEND_URL = "https://solana-trader-backend-production.up.railway.app";
        // const BACKEND_URL = "https://your-railway-url.up.railway.app";
        
        // Korapay Public Key
        const KORAPAY_PK = "pk_live_ksZpFkWrTV9mDChRzUPGb5s2cX2BHGriUAYYtJX8";
        
        // ============= GLOBAL VARIABLES =============
        let auth, db, storage;
        let currentUser = null;
        let userData = null;
        let firebaseInitialized = false;
        
        let currentRound = 1;
        let roundPhase = 'trading'; // trading, locking, live, ended
        let roundTime = 20;
        let roundInterval = null;
        let maintenanceInterval = null;
        
        let lotSize = 0.01;
        let openTrades = [];
        let allPlayers = [];
        let currentPrice = 100;
        let selectedPaymentMethod = 'card';
        let selectedDepositAmount = 50;
        let selectedWithdrawAmount = 100;
        
        // ============= INITIALIZATION =============
        function initializeFirebase() {
            try {
                firebase.initializeApp(FIREBASE_CONFIG);
                auth = firebase.auth();
                db = firebase.firestore();
                storage = firebase.storage();
                firebaseInitialized = true;
                
                // Auth state listener
                auth.onAuthStateChanged((user) => {
                    if (user) {
                        currentUser = user;
                        loadUserData();
                        showApp();
                    } else {
                        showAuth();
                    }
                });
                
                // Initialize time
                updateTime();
                setInterval(updateTime, 60000);
                
                // Check maintenance
                checkMaintenance();
                
                console.log("âœ… Firebase initialized successfully");
            } catch (error) {
                console.error("âŒ Firebase initialization error:", error);
                showToast("Failed to initialize app. Please refresh.", "error");
            }
        }
        
        // ============= TIME FUNCTIONS =============
        function updateTime() {
            const now = new Date();
            const timeStr = now.toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit', hour12: false });
            document.getElementById('currentTime').textContent = timeStr;
        }
        
        // ============= UI FUNCTIONS =============
        function showToast(message, type = 'info') {
            const container = document.getElementById('toastContainer');
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            
            let icon = 'info-circle';
            if (type === 'success') icon = 'check-circle';
            if (type === 'error') icon = 'exclamation-circle';
            if (type === 'warning') icon = 'exclamation-triangle';
            
            toast.innerHTML = `
                <i class="fas fa-${icon}"></i>
                <div>${message}</div>
            `;
            
            container.appendChild(toast);
            
            // Remove toast after 5 seconds
            setTimeout(() => {
                toast.style.animation = 'slideIn 0.3s ease-out reverse';
                setTimeout(() => toast.remove(), 300);
            }, 5000);
        }
        
        function showLoading(show = true) {
            document.getElementById('loadingOverlay').style.display = show ? 'flex' : 'none';
        }
        
        function showAuth() {
            document.getElementById('authContainer').style.display = 'flex';
            document.querySelector('.mobile-container').style.display = 'none';
            document.getElementById('loginBox').style.display = 'block';
            document.getElementById('signupBox').style.display = 'none';
        }
        
        function showApp() {
            document.getElementById('authContainer').style.display = 'none';
            document.querySelector('.mobile-container').style.display = 'block';
            showPage('dashboard');
            initTradingView();
            startRound();
        }
        
        function showPage(page) {
            // Hide all pages
            document.getElementById('dashboardPage').style.display = 'none';
            document.getElementById('profilePage').style.display = 'none';
            document.getElementById('leaderboardPage').style.display = 'none';
            document.getElementById('premiumPage').style.display = 'none';
            document.getElementById('referralPage').style.display = 'none';
            
            // Show selected page
            document.getElementById(`${page}Page`).style.display = 'block';
            
            // Update nav items
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
            });
            
            // Update nav based on page
            const navMap = {
                'dashboard': 0,
                'leaderboard': 1,
                'profile': 3,
                'referral': 4
            };
            
            if (navMap[page] !== undefined) {
                document.querySelectorAll('.nav-item')[navMap[page]].classList.add('active');
            }
            
            // Load data for specific pages
            if (page === 'leaderboard') loadLeaderboard('daily');
            if (page === 'referral') loadReferralData();
        }
        
        function togglePassword(inputId) {
            const input = document.getElementById(inputId);
            const toggle = input.nextElementSibling;
            if (input.type === 'password') {
                input.type = 'text';
                toggle.innerHTML = '<i class="fas fa-eye-slash"></i>';
            } else {
                input.type = 'password';
                toggle.innerHTML = '<i class="fas fa-eye"></i>';
            }
        }
        
        function showSignup() {
            document.getElementById('loginBox').style.display = 'none';
            document.getElementById('signupBox').style.display = 'block';
        }
        
        function showLogin() {
            document.getElementById('signupBox').style.display = 'none';
            document.getElementById('loginBox').style.display = 'block';
        }
        
        // ============= AUTHENTICATION =============
        async function login() {
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;
            
            if (!email || !password) {
                showToast("Please enter email and password", "error");
                return;
            }
            
            showLoading(true);
            
            try {
                await auth.signInWithEmailAndPassword(email, password);
                showToast("Login successful!", "success");
            } catch (error) {
                console.error("Login error:", error);
                let message = "Login failed";
                if (error.code === 'auth/user-not-found') message = "Account not found";
                else if (error.code === 'auth/wrong-password') message = "Incorrect password";
                else if (error.code === 'auth/invalid-email') message = "Invalid email";
                showToast(message, "error");
            } finally {
                showLoading(false);
            }
        }
        
        async function signup() {
            const name = document.getElementById('signupName').value;
            const username = document.getElementById('signupUsername').value;
            const email = document.getElementById('signupEmail').value;
            const dob = document.getElementById('signupDob').value;
            const password = document.getElementById('signupPassword').value;
            const confirmPassword = document.getElementById('signupConfirmPassword').value;
            const pin = document.getElementById('signupPin').value;
            const referralCode = document.getElementById('signupReferralCode').value;
            
            // Validation
            if (!name || !username || !email || !dob || !password || !confirmPassword || !pin) {
                showToast("Please fill all required fields", "error");
                return;
            }
            
            if (password !== confirmPassword) {
                showToast("Passwords do not match", "error");
                return;
            }
            
            if (pin.length !== 4 || !/^\d{4}$/.test(pin)) {
                showToast("PIN must be 4 digits", "error");
                return;
            }
            
            const birthDate = new Date(dob);
            const age = new Date().getFullYear() - birthDate.getFullYear();
            if (age < 18) {
                showToast("You must be 18+ to register", "error");
                return;
            }
            
            showLoading(true);
            
            try {
                // Create user with email/password
                const userCredential = await auth.createUserWithEmailAndPassword(email, password);
                const user = userCredential.user;
                
                // Generate unique referral code
                const userReferralCode = generateReferralCode();
                
                // Create user document
                await db.collection('users').doc(user.uid).set({
                    uid: user.uid,
                    name: name,
                    username: username.toLowerCase(),
                    email: email,
                    dob: dob,
                    pin: pin,
                    balance: 1.00, // $1 bonus
                    bonusBalance: 1.00,
                    totalTrades: 0,
                    wins: 0,
                    losses: 0,
                    joinDate: new Date().toISOString(),
                    isPro: false,
                    isPremium: false,
                    profilePic: `https://ui-avatars.com/api/?name=${encodeURIComponent(name)}&background=9945FF&color=fff`,
                    referralCode: userReferralCode,
                    referredBy: referralCode || null,
                    referralCount: 0,
                    referralEarnings: 0,
                    activeReferrals: 0,
                    totalProfit: 0,
                    winRate: 0,
                    lastLogin: new Date().toISOString()
                });
                
                // If referral code was provided, process it
                if (referralCode) {
                    try {
                        // Find referrer by referral code
                        const referrerQuery = await db.collection('users').where('referralCode', '==', referralCode.toUpperCase()).get();
                        if (!referrerQuery.empty) {
                            const referrerDoc = referrerQuery.docs[0];
                            const referrerData = referrerDoc.data();
                            
                            // Update referrer's referral count
                            await db.collection('users').doc(referrerDoc.id).update({
                                referralCount: (referrerData.referralCount || 0) + 1
                            });
                            
                            // Record the referral
                            await db.collection('referrals').add({
                                referrerId: referrerDoc.id,
                                referredUserId: user.uid,
                                referredEmail: email,
                                timestamp: new Date().toISOString(),
                                status: 'pending' // pending until deposit and trade
                            });
                            
                            showToast(`Referral code applied! You'll earn $1 bonus when you deposit and trade.`, "success");
                        }
                    } catch (error) {
                        console.error("Referral processing error:", error);
                    }
                }
                
                showToast("Account created successfully! You have $1 bonus to start trading.", "success");
                
            } catch (error) {
                console.error("Signup error:", error);
                let message = "Signup failed";
                if (error.code === 'auth/email-already-in-use') message = "Email already registered";
                else if (error.code === 'auth/weak-password') message = "Password too weak";
                showToast(message, "error");
            } finally {
                showLoading(false);
            }
        }
        
        function generateReferralCode() {
            const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';
            let code = '';
            for (let i = 0; i < 8; i++) {
                code += chars.charAt(Math.floor(Math.random() * chars.length));
            }
            return code;
        }
        
        async function logout() {
            try {
                await auth.signOut();
                showToast("Logged out successfully", "success");
            } catch (error) {
                console.error("Logout error:", error);
            }
        }
        
        // ============= USER DATA MANAGEMENT =============
        async function loadUserData() {
            if (!currentUser) return;
            
            try {
                const userDoc = await db.collection('users').doc(currentUser.uid).get();
                if (userDoc.exists) {
                    userData = userDoc.data();
                    updateUserUI();
                    
                    // Listen for real-time updates
                    db.collection('users').doc(currentUser.uid).onSnapshot((doc) => {
                        if (doc.exists) {
                            userData = doc.data();
                            updateUserUI();
                        }
                    });
                    
                    // Load open trades
                    loadOpenTrades();
                    
                    // Load players
                    loadPlayers();
                }
            } catch (error) {
                console.error("Error loading user data:", error);
            }
        }
        
        function updateUserUI() {
            if (!userData) return;
            
            // Update header
            document.getElementById('headerBalance').textContent = `$${userData.balance?.toFixed(2) || '0.00'}`;
            document.getElementById('headerProfilePic').src = userData.profilePic;
            
            // Update profile page
            document.getElementById('profileName').textContent = userData.name;
            document.getElementById('profileEmail').textContent = userData.email;
            document.getElementById('profileUsername').textContent = `@${userData.username}`;
            document.getElementById('profileAvatar').src = userData.profilePic;
            
            document.getElementById('totalTrades').textContent = userData.totalTrades || 0;
            document.getElementById('winRate').textContent = `${userData.winRate || 0}%`;
            document.getElementById('totalProfit').textContent = `$${userData.totalProfit || 0}`;
            
            // Update edit fields
            document.getElementById('editName').value = userData.name;
            document.getElementById('editUsername').value = userData.username;
            document.getElementById('editPin').value = userData.pin || '';
            
            // Update referral code
            document.getElementById('referralCode').textContent = userData.referralCode;
        }
        
        async function updateProfile() {
            const name = document.getElementById('editName').value;
            const username = document.getElementById('editUsername').value;
            const pin = document.getElementById('editPin').value;
            
            if (!name || !username) {
                showToast("Name and username are required", "error");
                return;
            }
            
            if (pin && (pin.length !== 4 || !/^\d{4}$/.test(pin))) {
                showToast("PIN must be 4 digits", "error");
                return;
            }
            
            showLoading(true);
            
            try {
                const updates = {
                    name: name,
                    username: username.toLowerCase(),
                    updatedAt: new Date().toISOString()
                };
                
                if (pin) updates.pin = pin;
                
                await db.collection('users').doc(currentUser.uid).update(updates);
                showToast("Profile updated successfully", "success");
            } catch (error) {
                console.error("Update profile error:", error);
                showToast("Failed to update profile", "error");
            } finally {
                showLoading(false);
            }
        }
        
        async function uploadProfilePicture() {
            const file = document.getElementById('avatarUpload').files[0];
            if (!file) return;
            
            if (!file.type.startsWith('image/')) {
                showToast("Please select an image file", "error");
                return;
            }
            
            if (file.size > 5 * 1024 * 1024) {
                showToast("Image must be less than 5MB", "error");
                return;
            }
            
            showLoading(true);
            
            try {
                // Upload to Firebase Storage
                const storageRef = storage.ref(`profile_pictures/${currentUser.uid}`);
                const uploadTask = storageRef.put(file);
                
                uploadTask.on('state_changed',
                    (snapshot) => {
                        // Progress monitoring
                        const progress = (snapshot.bytesTransferred / snapshot.totalBytes) * 100;
                        console.log(`Upload is ${progress}% done`);
                    },
                    (error) => {
                        console.error("Upload error:", error);
                        showToast("Upload failed", "error");
                        showLoading(false);
                    },
                    async () => {
                        // Upload completed
                        const downloadURL = await uploadTask.snapshot.ref.getDownloadURL();
                        
                        // Update user profile
                        await db.collection('users').doc(currentUser.uid).update({
                            profilePic: downloadURL,
                            updatedAt: new Date().toISOString()
                        });
                        
                        showToast("Profile picture updated", "success");
                        showLoading(false);
                    }
                );
                
            } catch (error) {
                console.error("Upload error:", error);
                showToast("Upload failed", "error");
                showLoading(false);
            }
        }
        
        // ============= TRADING FUNCTIONS =============
        function startRound() {
            clearInterval(roundInterval);
            roundTime = 20;
            roundPhase = 'trading';
            
            document.getElementById('phaseLabel').textContent = 'TRADING OPEN';
            document.getElementById('roundTimer').textContent = roundTime;
            
            roundInterval = setInterval(() => {
                roundTime--;
                document.getElementById('roundTimer').textContent = roundTime;
                
                if (roundTime === 10) {
                    roundPhase = 'locking';
                    document.getElementById('phaseLabel').textContent = 'TRADING LOCKED';
                    showToast("Trading locked. Chat opens for 10 seconds.", "info");
                } else if (roundTime === 0) {
                    roundPhase = 'live';
                    document.getElementById('phaseLabel').textContent = 'LIVE TRADING';
                    startLiveTrading();
                    showToast("Live trading started!", "info");
                } else if (roundTime === -15) {
                    endRound();
                }
            }, 1000);
        }
        
        function startLiveTrading() {
            // Simulate price movement
            const liveInterval = setInterval(() => {
                if (roundPhase !== 'live') {
                    clearInterval(liveInterval);
                    return;
                }
                
                // Random price movement
                const change = (Math.random() - 0.5) * 2;
                currentPrice += change;
                
                // Update trade profits
                updateTradeProfits();
                
            }, 500);
        }
        
        function setLotSize(size) {
            lotSize = size;
            document.querySelectorAll('.lot-btn').forEach(btn => {
                btn.classList.remove('active');
                if (parseFloat(btn.textContent) === size) {
                    btn.classList.add('active');
                }
            });
        }
        
        async function placeTrade(type) {
            if (roundPhase !== 'trading') {
                showToast("Trading not allowed in current phase", "error");
                return;
            }
            
            if (!userData) {
                showToast("Please wait for user data to load", "error");
                return;
            }
            
            const tp = parseFloat(document.getElementById('takeProfit').value) || 40;
            const sl = parseFloat(document.getElementById('stopLoss').value) || 20;
            const tradeCost = lotSize * 100;
            
            // Check if using bonus balance
            let useBonus = false;
            let actualBalance = userData.balance;
            
            if (userData.bonusBalance >= tradeCost) {
                useBonus = true;
                actualBalance = userData.bonusBalance;
            }
            
            if (actualBalance < tradeCost) {
                showToast("Insufficient balance", "error");
                return;
            }
            
            showLoading(true);
            
            try {
                const tradeData = {
                    userId: currentUser.uid,
                    username: userData.username,
                    profilePic: userData.profilePic,
                    type: type,
                    lotSize: lotSize,
                    entryPrice: currentPrice,
                    takeProfit: tp,
                    stopLoss: sl,
                    timestamp: new Date().toISOString(),
                    round: currentRound,
                    status: 'open',
                    currentProfit: 0,
                    profitPercent: 0,
                    useBonus: useBonus
                };
                
                // Add to Firestore
                const tradeRef = await db.collection('activeTrades').add(tradeData);
                tradeData.id = tradeRef.id;
                
                // Update user balance
                const updates = {};
                if (useBonus) {
                    updates.bonusBalance = userData.bonusBalance - tradeCost;
                } else {
                    updates.balance = userData.balance - tradeCost;
                }
                
                await db.collection('users').doc(currentUser.uid).update(updates);
                
                // Add to local array
                openTrades.push(tradeData);
                updateOpenTradesUI();
                
                showToast(`${type.toUpperCase()} trade placed! Lot: ${lotSize}`, "success");
                
            } catch (error) {
                console.error("Trade placement error:", error);
                showToast("Failed to place trade", "error");
            } finally {
                showLoading(false);
            }
        }
        
        function updateTradeProfits() {
            openTrades.forEach(trade => {
                const priceDiff = currentPrice - trade.entryPrice;
                const multiplier = trade.type === 'buy' ? 1 : -1;
                trade.currentProfit = priceDiff * 10 * multiplier * trade.lotSize;
                trade.profitPercent = (trade.currentProfit / (trade.lotSize * 100)) * 100;
                
                // Check TP/SL
                if (trade.currentProfit >= trade.takeProfit) {
                    closeTrade(trade.id, 'tp');
                } else if (trade.currentProfit <= -trade.stopLoss) {
                    closeTrade(trade.id, 'sl');
                }
            });
            
            updateOpenTradesUI();
        }
        
        async function loadOpenTrades() {
            try {
                const snapshot = await db.collection('activeTrades')
                    .where('userId', '==', currentUser.uid)
                    .where('status', '==', 'open')
                    .get();
                
                openTrades = [];
                snapshot.forEach(doc => {
                    openTrades.push({ id: doc.id, ...doc.data() });
                });
                
                updateOpenTradesUI();
                
            } catch (error) {
                console.error("Error loading open trades:", error);
            }
        }
        
        function updateOpenTradesUI() {
            const container = document.getElementById('openTradesList');
            container.innerHTML = '';
            
            document.getElementById('openTradesCount').textContent = openTrades.length;
            
            openTrades.forEach(trade => {
                const profitClass = trade.currentProfit >= 0 ? 'pnl-positive' : 'pnl-negative';
                const profitSign = trade.currentProfit >= 0 ? '+' : '';
                
                const tradeHTML = `
                    <div class="trade-item ${trade.type}">
                        <div class="trade-header">
                            <div class="trade-type ${trade.type}">
                                <i class="fas fa-${trade.type === 'buy' ? 'arrow-up' : 'arrow-down'}"></i>
                                ${trade.type.toUpperCase()}
                            </div>
                            <div class="trade-pnl ${profitClass}">
                                ${profitSign}$${trade.currentProfit.toFixed(2)}
                            </div>
                        </div>
                        <div class="trade-details">
                            <div class="detail-item">
                                <label>Lot Size</label>
                                <span>${trade.lotSize}</span>
                            </div>
                            <div class="detail-item">
                                <label>Entry Price</label>
                                <span>$${trade.entryPrice.toFixed(2)}</span>
                            </div>
                            <div class="detail-item">
                                <label>Take Profit</label>
                                <span>$${trade.takeProfit}</span>
                            </div>
                            <div class="detail-item">
                                <label>Stop Loss</label>
                                <span>$${trade.stopLoss}</span>
                            </div>
                        </div>
                        <div class="trade-actions">
                            <button class="close-btn" onclick="closeTrade('${trade.id}', 'manual')">
                                <i class="fas fa-times"></i> Close Trade
                            </button>
                        </div>
                    </div>
                `;
                
                container.innerHTML += tradeHTML;
            });
        }
        
        async function closeTrade(tradeId, reason) {
            try {
                const tradeIndex = openTrades.findIndex(t => t.id === tradeId);
                if (tradeIndex === -1) return;
                
                const trade = openTrades[tradeIndex];
                const finalProfit = trade.currentProfit || 0;
                const tradeValue = trade.lotSize * 100;
                
                // Calculate new balance
                let balanceUpdate = {};
                const totalReturn = tradeValue + finalProfit;
                
                if (trade.useBonus) {
                    // Bonus can only be multiplied, not withdrawn
                    balanceUpdate.bonusBalance = (userData.bonusBalance || 0) + totalReturn;
                    
                    // If bonus reaches $3, convert to withdrawable balance
                    if (balanceUpdate.bonusBalance >= 3) {
                        balanceUpdate.balance = (userData.balance || 0) + balanceUpdate.bonusBalance;
                        balanceUpdate.bonusBalance = 0;
                        showToast("Bonus converted to withdrawable balance!", "success");
                    }
                } else {
                    balanceUpdate.balance = (userData.balance || 0) + totalReturn;
                }
                
                // Update user stats
                balanceUpdate.totalTrades = (userData.totalTrades || 0) + 1;
                balanceUpdate.totalProfit = (userData.totalProfit || 0) + finalProfit;
                
                if (finalProfit > 0) {
                    balanceUpdate.wins = (userData.wins || 0) + 1;
                } else {
                    balanceUpdate.losses = (userData.losses || 0) + 1;
                }
                
                // Calculate win rate
                const wins = balanceUpdate.wins || userData.wins || 0;
                const totalTrades = balanceUpdate.totalTrades;
                balanceUpdate.winRate = totalTrades > 0 ? Math.round((wins / totalTrades) * 100) : 0;
                
                // Save to trade history
                await db.collection('tradeHistory').add({
                    ...trade,
                    exitPrice: currentPrice,
                    exitTime: new Date().toISOString(),
                    closeReason: reason,
                    finalProfit: finalProfit,
                    status: 'closed'
                });
                
                // Update user
                await db.collection('users').doc(currentUser.uid).update(balanceUpdate);
                
                // Remove from active trades
                await db.collection('activeTrades').doc(tradeId).delete();
                
                // Remove from local array
                openTrades.splice(tradeIndex, 1);
                updateOpenTradesUI();
                
                let message = '';
                if (reason === 'tp') message = 'Take profit hit!';
                else if (reason === 'sl') message = 'Stop loss triggered!';
                else message = 'Trade closed manually';
                
                showToast(`${message} Profit: $${finalProfit.toFixed(2)}`, finalProfit >= 0 ? 'success' : 'error');
                
            } catch (error) {
                console.error("Close trade error:", error);
                showToast("Failed to close trade", "error");
            }
        }
        
        // ============= PLAYERS MANAGEMENT =============
        async function loadPlayers() {
            try {
                const snapshot = await db.collection('activeTrades')
                    .where('round', '==', currentRound)
                    .get();
                
                allPlayers = [];
                snapshot.forEach(doc => {
                    allPlayers.push(doc.data());
                });
                
                updatePlayersUI();
                
            } catch (error) {
                console.error("Error loading players:", error);
            }
        }
        
        function updatePlayersUI() {
            const container = document.getElementById('playersList');
            container.innerHTML = '';
            
            document.getElementById('playersCount').textContent = allPlayers.length;
            
            // Sort by profit
            allPlayers.sort((a, b) => (b.currentProfit || 0) - (a.currentProfit || 0));
            
            allPlayers.forEach(player => {
                const profitClass = (player.currentProfit || 0) >= 0 ? 'pnl-positive' : 'pnl-negative';
                const profitSign = (player.currentProfit || 0) >= 0 ? '+' : '';
                
                const playerHTML = `
                    <div class="player-item">
                        <img src="${player.profilePic}" alt="${player.username}" class="player-avatar">
                        <div class="player-info">
                            <div class="player-name">${player.username}</div>
                            <div class="player-stats">
                                <span>${player.type.toUpperCase()}</span>
                                <span>Lot: ${player.lotSize}</span>
                            </div>
                        </div>
                        <div class="player-pnl ${profitClass}">
                            ${profitSign}$${(player.currentProfit || 0).toFixed(2)}
                        </div>
                    </div>
                `;
                
                container.innerHTML += playerHTML;
            });
        }
        
        // ============= PAYMENT FUNCTIONS =============
        function showDepositModal() {
            document.getElementById('depositModal').style.display = 'flex';
            updateDepositSummary();
        }
        
        function showWithdrawModal() {
            document.getElementById('withdrawModal').style.display = 'flex';
            updateWithdrawSummary();
        }
        
        function showTransactionHistory() {
            document.getElementById('transactionModal').style.display = 'flex';
            loadTransactionHistory();
        }
        
        function closePaymentModal() {
            document.querySelectorAll('.payment-modal').forEach(modal => {
                modal.style.display = 'none';
            });
        }
        
        function selectPaymentMethod(method) {
            selectedPaymentMethod = method;
            document.querySelectorAll('.payment-method').forEach(el => {
                el.classList.remove('active');
                if (el.querySelector('i').className.includes(method === 'card' ? 'credit-card' : 'university')) {
                    el.classList.add('active');
                }
            });
        }
        
        function selectDepositAmount(amount) {
            selectedDepositAmount = amount;
            document.getElementById('depositAmount').value = amount;
            document.querySelectorAll('#depositModal .amount-option').forEach(el => {
                el.classList.remove('active');
                if (parseInt(el.textContent.replace('$', '')) === amount) {
                    el.classList.add('active');
                }
            });
            updateDepositSummary();
        }
        
        function selectWithdrawAmount(amount) {
            selectedWithdrawAmount = amount;
            document.getElementById('withdrawAmount').value = amount;
            document.querySelectorAll('#withdrawModal .amount-option').forEach(el => {
                el.classList.remove('active');
                const optionAmount = parseInt(el.textContent.replace('$', '').replace(',', ''));
                if (optionAmount === amount) {
                    el.classList.add('active');
                }
            });
            updateWithdrawSummary();
        }
        
        function updateDepositSummary() {
            const amount = parseFloat(document.getElementById('depositAmount').value) || 0;
            const fee = amount * 0.025;
            const total = amount + fee;
            
            document.getElementById('depositSummaryAmount').textContent = `$${amount.toFixed(2)}`;
            document.getElementById('depositFee').textContent = `$${fee.toFixed(2)}`;
            document.getElementById('depositTotal').textContent = `$${total.toFixed(2)}`;
        }
        
        function updateWithdrawSummary() {
            const amount = parseFloat(document.getElementById('withdrawAmount').value) || 0;
            const fee = amount * 0.015;
            const tax = amount * 0.10;
            const total = amount - fee - tax;
            
            document.getElementById('withdrawSummaryAmount').textContent = `$${amount.toFixed(2)}`;
            document.getElementById('withdrawFee').textContent = `$${fee.toFixed(2)}`;
            document.getElementById('withdrawTax').textContent = `$${tax.toFixed(2)}`;
            document.getElementById('withdrawTotal').textContent = `$${total.toFixed(2)}`;
        }
        
        async function processDeposit() {
            const amount = parseFloat(document.getElementById('depositAmount').value) || 0;
            
            if (amount < 5) {
                showToast("Minimum deposit is $5", "error");
                return;
            }
            
            if (amount > 10000) {
                showToast("Maximum deposit is $10,000", "error");
                return;
            }
            
            showLoading(true);
            
            try {
                // Generate unique reference
                const reference = `DEP_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;
                const fee = amount * 0.025;
                const total = amount + fee;
                
                // Initialize Korapay payment
                window.Korapay.initialize({
                    key: KORAPAY_PK,
                    reference: reference,
                    amount: total * 100, // Convert to kobo
                    currency: "USD",
                    customer: {
                        name: userData.name,
                        email: userData.email
                    },
                    metadata: {
                        userId: currentUser.uid,
                        type: 'deposit'
                    },
                    onClose: function() {
                        showToast("Payment cancelled", "warning");
                        showLoading(false);
                    },
                    onSuccess: async function(response) {
                        console.log("Payment success:", response);
                        
                        // Record transaction
                        await db.collection('transactions').add({
                            userId: currentUser.uid,
                            type: 'deposit',
                            amount: amount,
                            fee: fee,
                            total: total,
                            method: selectedPaymentMethod,
                            status: 'successful',
                            timestamp: new Date().toISOString(),
                            reference: reference,
                            korapayReference: response.reference,
                            userEmail: userData.email,
                            userName: userData.name
                        });
                        
                        // Update user balance
                        const newBalance = (userData.balance || 0) + amount;
                        await db.collection('users').doc(currentUser.uid).update({
                            balance: newBalance
                        });
                        
                        // Check if this is first deposit for referral
                        if (userData.referredBy) {
                            // Find referrer and mark referral as completed
                            const referrerQuery = await db.collection('users').where('referralCode', '==', userData.referredBy).get();
                            if (!referrerQuery.empty) {
                                const referrerDoc = referrerQuery.docs[0];
                                const referrerData = referrerDoc.data();
                                
                                // Update active referrals count
                                await db.collection('users').doc(referrerDoc.id).update({
                                    activeReferrals: (referrerData.activeReferrals || 0) + 1
                                });
                                
                                // Check if referrer earns $2 (every 10 referrals)
                                const newActiveCount = (referrerData.activeReferrals || 0) + 1;
                                if (newActiveCount % 10 === 0) {
                                    await db.collection('users').doc(referrerDoc.id).update({
                                        referralEarnings: (referrerData.referralEarnings || 0) + 2,
                                        balance: (referrerData.balance || 0) + 2
                                    });
                                    
                                    // Record referral bonus transaction
                                    await db.collection('transactions').add({
                                        userId: referrerDoc.id,
                                        type: 'referral_bonus',
                                        amount: 2,
                                        status: 'successful',
                                        timestamp: new Date().toISOString(),
                                        reference: `REF_BONUS_${Date.now()}`,
                                        description: `Referral bonus for 10 active referrals`
                                    });
                                }
                            }
                        }
                        
                        showToast(`Deposit successful! $${amount} added to your balance`, "success");
                        closePaymentModal();
                        showLoading(false);
                        
                    },
                    onFailed: function(response) {
                        console.log("Payment failed:", response);
                        
                        // Record failed transaction
                        db.collection('transactions').add({
                            userId: currentUser.uid,
                            type: 'deposit',
                            amount: amount,
                            fee: fee,
                            total: total,
                            method: selectedPaymentMethod,
                            status: 'failed',
                            timestamp: new Date().toISOString(),
                            reference: reference,
                            failedReason: response.message,
                            userEmail: userData.email,
                            userName: userData.name
                        });
                        
                        showToast("Payment failed: " + response.message, "error");
                        showLoading(false);
                    }
                });
                
            } catch (error) {
                console.error("Deposit processing error:", error);
                showToast("Payment processing failed", "error");
                showLoading(false);
            }
        }
        
        async function processWithdrawal() {
            const amount = parseFloat(document.getElementById('withdrawAmount').value) || 0;
            const bankName = document.getElementById('bankName').value;
            const accountNumber = document.getElementById('accountNumber').value;
            const accountName = document.getElementById('accountName').value;
            const pin = document.getElementById('withdrawPin').value;
            
            if (amount < 20) {
                showToast("Minimum withdrawal is $20", "error");
                return;
            }
            
            if (amount > 10000) {
                showToast("Maximum withdrawal is $10,000", "error");
                return;
            }
            
            if (!bankName || !accountNumber || !accountName) {
                showToast("Please fill all bank details", "error");
                return;
            }
            
            if (pin !== userData.pin) {
                showToast("Invalid transaction PIN", "error");
                return;
            }
            
            if (amount > (userData.balance || 0)) {
                showToast("Insufficient balance", "error");
                return;
            }
            
            showLoading(true);
            
            try {
                const fee = amount * 0.015;
                const tax = amount * 0.10;
                const netAmount = amount - fee - tax;
                const reference = `WDL_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;
                
                // Record withdrawal
                await db.collection('transactions').add({
                    userId: currentUser.uid,
                    type: 'withdrawal',
                    amount: amount,
                    fee: fee,
                    tax: tax,
                    netAmount: netAmount,
                    bankName: bankName,
                    accountNumber: accountNumber,
                    accountName: accountName,
                    status: 'pending',
                    timestamp: new Date().toISOString(),
                    reference: reference,
                    userEmail: userData.email,
                    userName: userData.name
                });
                
                // Deduct from balance
                const newBalance = (userData.balance || 0) - amount;
                await db.collection('users').doc(currentUser.uid).update({
                    balance: newBalance
                });
                
                showToast(`Withdrawal request submitted! $${netAmount.toFixed(2)} will be sent within 24-48 hours.`, "success");
                closePaymentModal();
                showLoading(false);
                
                // In production, you would call Korapay Payout API here
                // await processKorapayPayout(accountNumber, bankName, accountName, netAmount, reference);
                
            } catch (error) {
                console.error("Withdrawal processing error:", error);
                showToast("Withdrawal processing failed", "error");
                showLoading(false);
            }
        }
        
        async function loadTransactionHistory() {
            try {
                const snapshot = await db.collection('transactions')
                    .where('userId', '==', currentUser.uid)
                    .orderBy('timestamp', 'desc')
                    .limit(20)
                    .get();
                
                const container = document.getElementById('transactionList');
                container.innerHTML = '';
                
                snapshot.forEach(doc => {
                    const tx = doc.data();
                    const date = new Date(tx.timestamp).toLocaleDateString();
                    const time = new Date(tx.timestamp).toLocaleTimeString();
                    
                    let statusClass = 'status-pending';
                    if (tx.status === 'successful') statusClass = 'status-success';
                    if (tx.status === 'failed') statusClass = 'status-failed';
                    
                    const txHTML = `
                        <div class="transaction-item ${tx.type}" style="margin-bottom: 10px;">
                            <div style="flex: 1;">
                                <div style="font-weight: 600;">${tx.type.toUpperCase()}</div>
                                <div style="font-size: 12px; color: var(--text-secondary)">${date} ${time}</div>
                                <div style="font-size: 11px; color: var(--text-muted)">${tx.reference}</div>
                            </div>
                            <div style="font-weight: 700; color: ${tx.type === 'deposit' || tx.type === 'referral_bonus' ? 'var(--success)' : 'var(--warning)'}">
                                ${tx.type === 'deposit' || tx.type === 'referral_bonus' ? '+' : '-'}$${tx.amount?.toFixed(2) || '0.00'}
                            </div>
                        </div>
                    `;
                    
                    container.innerHTML += txHTML;
                });
                
            } catch (error) {
                console.error("Error loading transactions:", error);
            }
        }
        
        // ============= REFERRAL SYSTEM =============
        async function loadReferralData() {
            try {
                const snapshot = await db.collection('referrals')
                    .where('referrerId', '==', currentUser.uid)
                    .orderBy('timestamp', 'desc')
                    .get();
                
                document.getElementById('totalReferrals').textContent = snapshot.size;
                
                // Count active referrals (those who deposited and traded)
                let activeCount = 0;
                snapshot.forEach(doc => {
                    if (doc.data().status === 'completed') activeCount++;
                });
                
                document.getElementById('activeReferrals').textContent = activeCount;
                document.getElementById('referralEarnings').textContent = `$${userData.referralEarnings || 0}`;
                
                // Display referral list
                const container = document.getElementById('referralList');
                container.innerHTML = '';
                
                snapshot.forEach(doc => {
                    const ref = doc.data();
                    const date = new Date(ref.timestamp).toLocaleDateString();
                    
                    const refHTML = `
                        <div class="player-item" style="margin-bottom: 10px;">
                            <div class="player-info">
                                <div class="player-name">${ref.referredEmail}</div>
                                <div class="player-stats">
                                    <span>${date}</span>
                                    <span style="color: ${ref.status === 'completed' ? 'var(--success)' : 'var(--warning)'}">
                                        ${ref.status === 'completed' ? 'Active' : 'Pending'}
                                    </span>
                                </div>
                            </div>
                        </div>
                    `;
                    
                    container.innerHTML += refHTML;
                });
                
            } catch (error) {
                console.error("Error loading referral data:", error);
            }
        }
        
        function copyReferralCode() {
            const code = document.getElementById('referralCode').textContent;
            navigator.clipboard.writeText(code).then(() => {
                showToast("Referral code copied to clipboard!", "success");
            });
        }
        
        // ============= PREMIUM UPGRADES =============
        async function upgradeToPlan(plan) {
            const amount = plan === 'pro' ? 10 : 25;
            
            if ((userData.balance || 0) < amount) {
                showToast(`Insufficient balance. Need $${amount}`, "error");
                return;
            }
            
            showLoading(true);
            
            try {
                const updates = {
                    balance: (userData.balance || 0) - amount
                };
                
                if (plan === 'pro') {
                    updates.isPro = true;
                } else {
                    updates.isPremium = true;
                    updates.isPro = true; // Premium includes Pro
                }
                
                await db.collection('users').doc(currentUser.uid).update(updates);
                
                // Record transaction
                await db.collection('transactions').add({
                    userId: currentUser.uid,
                    type: 'upgrade',
                    amount: amount,
                    status: 'successful',
                    timestamp: new Date().toISOString(),
                    reference: `UPG_${plan.toUpperCase()}_${Date.now()}`,
                    description: `${plan.charAt(0).toUpperCase() + plan.slice(1)} plan upgrade`
                });
                
                showToast(`${plan.charAt(0).toUpperCase() + plan.slice(1)} upgrade successful!`, "success");
                showPage('dashboard');
                
            } catch (error) {
                console.error("Upgrade error:", error);
                showToast("Upgrade failed", "error");
            } finally {
                showLoading(false);
            }
        }
        
        // ============= LEADERBOARD =============
        async function loadLeaderboard(timeframe) {
            try {
                const usersSnapshot = await db.collection('users')
                    .where('isBanned', '!=', true)
                    .limit(50)
                    .get();
                
                const leaderboard = [];
                
                for (const userDoc of usersSnapshot.docs) {
                    const user = userDoc.data();
                    
                    // Get user's recent trades based on timeframe
                    let startDate = new Date();
                    switch (timeframe) {
                        case 'daily':
                            startDate.setDate(startDate.getDate() - 1);
                            break;
                        case 'weekly':
                            startDate.setDate(startDate.getDate() - 7);
                            break;
                        case 'monthly':
                            startDate.setMonth(startDate.getMonth() - 1);
                            break;
                        default:
                            startDate = new Date(0);
                    }
                    
                    const tradesSnapshot = await db.collection('tradeHistory')
                        .where('userId', '==', userDoc.id)
                        .where('timestamp', '>=', startDate.toISOString())
                        .get();
                    
                    let totalProfit = 0;
                    tradesSnapshot.forEach(tradeDoc => {
                        const trade = tradeDoc.data();
                        totalProfit += trade.finalProfit || 0;
                    });
                    
                    leaderboard.push({
                        userId: userDoc.id,
                        username: user.username,
                        profilePic: user.profilePic,
                        totalProfit,
                        winRate: user.winRate || 0,
                        totalTrades: tradesSnapshot.size
                    });
                }
                
                // Sort by profit
                leaderboard.sort((a, b) => b.totalProfit - a.totalProfit);
                
                // Display leaderboard
                const container = document.getElementById('leaderboardList');
                container.innerHTML = '';
                
                leaderboard.slice(0, 20).forEach((player, index) => {
                    const rank = index + 1;
                    let rankColor = 'var(--text-primary)';
                    if (rank === 1) rankColor = 'gold';
                    if (rank === 2) rankColor = 'silver';
                    if (rank === 3) rankColor = '#cd7f32';
                    
                    const playerHTML = `
                        <div class="player-item" style="margin-bottom: 10px;">
                            <div style="font-weight: 800; font-size: 20px; width: 40px; text-align: center; color: ${rankColor}">
                                ${rank}
                            </div>
                            <img src="${player.profilePic}" alt="${player.username}" class="player-avatar">
                            <div class="player-info">
                                <div class="player-name">${player.username}</div>
                                <div class="player-stats">
                                    <span>${player.totalTrades} trades</span>
                                    <span>${player.winRate}% win rate</span>
                                </div>
                            </div>
                            <div class="player-pnl ${player.totalProfit >= 0 ? 'pnl-positive' : 'pnl-negative'}">
                                ${player.totalProfit >= 0 ? '+' : ''}$${player.totalProfit.toFixed(2)}
                            </div>
                        </div>
                    `;
                    
                    container.innerHTML += playerHTML;
                });
                
            } catch (error) {
                console.error("Leaderboard error:", error);
            }
        }
        
        // ============= MAINTENANCE SYSTEM =============
        function checkMaintenance() {
            // Maintenance every 12 hours for 3 minutes
            const now = new Date();
            const hours = now.getUTCHours();
            const minutes = now.getUTCMinutes();
            
            // Calculate next maintenance time
            const nextMaintenance = new Date(now);
            nextMaintenance.setUTCHours(hours + (12 - (hours % 12)), 0, 0, 0);
            
            // Check if in maintenance window (3 minutes every 12 hours)
            if (hours % 12 === 0 && minutes < 3) {
                startMaintenance();
            }
            
            // Update next maintenance display
            const timeDiff = nextMaintenance - now;
            const hoursLeft = Math.floor(timeDiff / (1000 * 60 * 60));
            const minutesLeft = Math.floor((timeDiff % (1000 * 60 * 60)) / (1000 * 60));
            const secondsLeft = Math.floor((timeDiff % (1000 * 60)) / 1000);
            
            document.getElementById('nextMaintenance').textContent = 
                `${hoursLeft.toString().padStart(2, '0')}:${minutesLeft.toString().padStart(2, '0')}:${secondsLeft.toString().padStart(2, '0')}`;
        }
        
        function startMaintenance() {
            document.getElementById('maintenanceScreen').style.display = 'flex';
            clearInterval(roundInterval);
            
            // Start 3 minute countdown
            let maintenanceTime = 180; // 3 minutes in seconds
            
            function updateMaintenanceTimer() {
                const minutes = Math.floor(maintenanceTime / 60);
                const seconds = maintenanceTime % 60;
                document.getElementById('maintenanceTimer').textContent = 
                    `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
                
                if (maintenanceTime <= 0) {
                    clearInterval(maintenanceInterval);
                    document.getElementById('maintenanceScreen').style.display = 'none';
                    startRound();
                }
                
                maintenanceTime--;
            }
            
            updateMaintenanceTimer();
            maintenanceInterval = setInterval(updateMaintenanceTimer, 1000);
            
            // Load winners from previous 12 hours
            loadMaintenanceWinners();
        }
        
        async function loadMaintenanceWinners() {
            try {
                // Get trades from last 12 hours
                const twelveHoursAgo = new Date(Date.now() - 12 * 60 * 60 * 1000);
                
                const snapshot = await db.collection('tradeHistory')
                    .where('timestamp', '>=', twelveHoursAgo.toISOString())
                    .get();
                
                const winners = [];
                snapshot.forEach(doc => {
                    const trade = doc.data();
                    if (trade.finalProfit > 0) {
                        winners.push({
                            username: trade.username,
                            profit: trade.finalProfit
                        });
                    }
                });
                
                // Sort by profit
                winners.sort((a, b) => b.profit - a.profit);
                
                // Display top 5
                const container = document.getElementById('winnersList');
                container.innerHTML = '<h3 style="margin-bottom: 15px;">Top Winners (Last 12h)</h3>';
                
                winners.slice(0, 5).forEach((winner, index) => {
                    const winnerHTML = `
                        <div class="player-item" style="margin-bottom: 10px;">
                            <div style="font-weight: 800; font-size: 20px; width: 40px; text-align: center; color: ${index === 0 ? 'gold' : index === 1 ? 'silver' : index === 2 ? '#cd7f32' : 'var(--text-primary)'}">
                                ${index + 1}
                            </div>
                            <div class="player-info">
                                <div class="player-name">${winner.username}</div>
                            </div>
                            <div class="player-pnl pnl-positive">
                                +$${winner.profit.toFixed(2)}
                            </div>
                        </div>
                    `;
                    container.innerHTML += winnerHTML;
                });
                
            } catch (error) {
                console.error("Error loading maintenance winners:", error);
            }
        }
        
        // ============= TRADINGVIEW CHART =============
        function initTradingView() {
            if (typeof TradingView === 'undefined') {
                setTimeout(initTradingView, 1000);
                return;
            }
            
            // Your TradingView widget configuration
            new TradingView.widget({
                "container_id": "tradingview-chart",
                "width": "100%",
                "height": "100%",
                "symbol": "COINBASE:SOLUSD",
                "interval": "1",
                "timezone": "Etc/UTC",
                "theme": "dark",
                "style": "1",
                "locale": "en",
                "toolbar_bg": "#1A1A2E",
                "enable_publishing": false,
                "hide_side_toolbar": false,
                "allow_symbol_change": true,
                "studies": ["Volume@tv-basicstudies"],
                "show_popup_button": true,
                "popup_width": "1000",
                "popup_height": "650",
                "custom_css_url": "https://example.com/custom.css"
            });
        }
        
        // ============= END ROUND =============
        function endRound() {
            clearInterval(roundInterval);
            roundPhase = 'ended';
            document.getElementById('phaseLabel').textContent = 'ROUND ENDED';
            
            // Close all open trades
            openTrades.forEach(trade => {
                closeTrade(trade.id, 'round_end');
            });
            
            // Show animation and start next round after 5 seconds
            setTimeout(() => {
                currentRound++;
                startRound();
            }, 5000);
        }
        
        // ============= INITIALIZE APP =============
        document.addEventListener('DOMContentLoaded', () => {
            initializeFirebase();
            
            // Add event listeners
            document.getElementById('depositAmount').addEventListener('input', updateDepositSummary);
            document.getElementById('withdrawAmount').addEventListener('input', updateWithdrawSummary);
            
            // Auto-select card payment by default
            selectPaymentMethod('card');
        });
    </script>
</body>
</html>
